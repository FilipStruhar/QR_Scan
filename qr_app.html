<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
</head>
<body>
    <button onclick="startScanner()">Scan QR Code</button>
    <div id="reader" style="width: 300px; display: none;"></div>
    <p>Scanned QR Code: <span id="result"></span></p>
    <button id="submitBtn" onclick="submitQR()" disabled>Submit</button>

    <script>
        let scannedValue = ""; // Variable to store QR value

        function startScanner() {
            document.getElementById("reader").style.display = "block";
            const html5QrCode = new Html5Qrcode("reader");

            html5QrCode.start(
                { facingMode: "environment" },  
                { fps: 10, qrbox: 250 },
                qrCodeMessage => {
                    scannedValue = qrCodeMessage;
                    document.getElementById("result").innerText = scannedValue;
                    document.getElementById("submitBtn").disabled = false;
                    html5QrCode.stop();
                    document.getElementById("reader").style.display = "none";
                },
                errorMessage => {}
            ).catch(err => console.error(err));
        }

        function submitQR() {
            fetch("http://127.0.0.1:5000/submit", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ qr_code: scannedValue })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => console.error("Error:", error));
        }
    </script>
</body>
</html>
